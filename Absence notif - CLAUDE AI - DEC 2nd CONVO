Claude AI - December 2nd convo contents.

Implementation Steps
1. Add Your LINE User IDs to the Apps Script
First, you need to get your and your wife's LINE User IDs.

Add these constants at the top of your Apps Script (near where you have LINE_CHANNEL_ACCESS_TOKEN):

// Add these lines after LINE_CHANNEL_SECRET
var TEACHER_LINE_ID = 'YOUR_LINE_USER_ID_HERE';
var WIFE_LINE_ID = 'YOUR_WIFE_LINE_USER_ID_HERE';

2. Modify the markStudentAbsent Function
Update your markStudentAbsent function to send notifications after successfully marking the absence:

function markStudentAbsent(replyToken, studentId, studentName, date) {
  try {
    const calendar = CalendarApp.getCalendarById('mckayenglishsakura@gmail.com');
    
    if (!calendar) {
      replyToLine(replyToken, 'ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã¾ã›ã‚“ã§ã—ãŸã€‚');
      return;
    }
    
    const lessonDate = new Date(date + 'T00:00:00');
    const startTime = new Date(lessonDate);
    const endTime = new Date(lessonDate);

    // Set time range based on day of week
    if (lessonDate.getDay() === 6) { // Saturday
      startTime.setHours(10, 0, 0, 0);
    } else {
      startTime.setHours(16, 10, 0, 0);
    }
    endTime.setHours(22, 0, 0, 0);

    const events = calendar.getEvents(startTime, endTime);
    const targetEvents = events.filter(e => e.getTitle().includes(studentName));

    if (targetEvents.length === 0) {
      replyToLine(replyToken, `âš ï¸ ${studentName}ã®${date}ã®ãƒ¬ãƒƒã‚¹ãƒ³ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚`);
      return;
    }

    targetEvents.forEach(event => {
      const originalTitle = event.getTitle();
      if (!originalTitle.includes('[Absent]')) {
        event.setTitle(`[Absent] ${originalTitle}`);
      }
      event.setColor(CalendarApp.EventColor.GRAY);
    });

    // Log the absence
    logAbsence(studentId, studentName, date);

    // Send notifications to teachers
    notifyTeachersOfAbsence(studentName, date);

    // Reply to the parent
    replyToLine(replyToken, `âœ… ${studentName}ã®${date}ã®æ¬ å¸­ã‚’è¨˜éŒ²ã—ã¾ã—ãŸã€‚`);

  } catch (error) {
    logError('markStudentAbsent error: ' + error);
    replyToLine(replyToken, 'ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚å…ˆç”Ÿã«ãŠå•ã„åˆã‚ã›ãã ã•ã„ã€‚');
  }
}

// New function to notify teachers
function notifyTeachersOfAbsence(studentName, absenceDate) {
  // Format the date nicely
  const dateObj = new Date(absenceDate);
  const formattedDate = Utilities.formatDate(dateObj, TIMEZONE, 'Mæœˆdæ—¥ (E)');
  
  const message = `ğŸ”” æ¬ å¸­é€šçŸ¥\n\nç”Ÿå¾’: ${studentName}\næ—¥ä»˜: ${formattedDate}\n\nä¿è­·è€…ã‹ã‚‰LINEã§æ¬ å¸­é€£çµ¡ãŒã‚ã‚Šã¾ã—ãŸã€‚`;
  
  // Send to both teachers
  try {
    if (TEACHER_LINE_ID) {
      pushToLine(TEACHER_LINE_ID, message);
    }
    if (WIFE_LINE_ID) {
      pushToLine(WIFE_LINE_ID, message);
    }
    Logger.log('Absence notification sent for: ' + studentName + ' on ' + absenceDate);
  } catch (error) {
    logError('notifyTeachersOfAbsence error: ' + error);
  }
}
